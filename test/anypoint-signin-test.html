<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
  <title>anypoint-signin test</title>

  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
  <script src="../node_modules/mocha/mocha.js"></script>
  <script src="../node_modules/chai/chai.js"></script>
  <script src="../node_modules/wct-mocha/wct-mocha.js"></script>
  <script src="../node_modules/sinon/pkg/sinon.js"></script>

  <script type="module" src="../anypoint-signin.js"></script>
</head>

<body>
  <test-fixture id="basic">
    <template>
      <anypoint-signin></anypoint-signin>
    </template>
  </test-fixture>

  <test-fixture id="noink">
    <template>
      <anypoint-signin noink></anypoint-signin>
    </template>
  </test-fixture>

  <test-fixture id="SetupReady">
    <template>
      <anypoint-signin client-id="abc" redirect-uri="https://auth.domain.com"></anypoint-signin>
    </template>
  </test-fixture>

  <script type="module">
suite('Basic', function() {
  let element;
  setup(function() {
    element = fixture('basic');
  });
  test('_labelSignin is computed', function() {
    assert.equal(element._labelSignin, 'Sign in');
  });
});

suite('_computeButtonClass()', function() {
  let element;
  setup(function() {
    element = fixture('basic');
  });
  test('Computes classes', function() {
    const result = element._computeButtonClass('a', 'b', 'c', true);
    assert.equal(result, 'height-a width-b theme-c signedIn-true');
  });
});

suite('_computeSigninLabel()', function() {
  let element;
  setup(function() {
    element = fixture('basic');
  });

  test('Returns defined value', function() {
    const width = 'wide';
    const label = 'test';
    const result = element._computeSigninLabel(label, width);
    assert.equal(result, label);
  });

  test('Returns "WIDE" value', function() {
    const width = 'wide';
    const label = '';
    const result = element._computeSigninLabel(label, width);
    assert.equal(result, 'Sign in with Exchange');
  });

  test('Returns "STANDARD" value', function() {
    const width = 'standard';
    const label = '';
    const result = element._computeSigninLabel(label, width);
    assert.equal(result, 'Sign in');
  });

  test('Returns "ICON_ONLY" value', function() {
    const width = 'iconOnly';
    const label = '';
    const result = element._computeSigninLabel(label, width);
    assert.equal(result, '');
  });

  test('Returns default value', function() {
    const width = '';
    const label = '';
    const result = element._computeSigninLabel(label, width);
    assert.equal(result, 'Sign in');
  });
});

suite('No ink', function() {
  let element;
  setup(function(done) {
    element = fixture('noink');
    flush(() => done());
  });
  test('Ripple is not rendered', function() {
    const ripple = element.shadowRoot.querySelector('paper-ripple');
    assert.notOk(ripple);
  });
});

suite('Buttons state', function() {
  let element;
  setup(function(done) {
    element = fixture('basic');
    flush(() => done());
  });

  test('Sign in button is rendered', function() {
    const button = element.shadowRoot.querySelector('.signIn');
    assert.ok(button);
    const display = getComputedStyle(button).display;
    assert.notEqual(display, 'none');
  });

  test('Sign out button not rendered', function() {
    const button = element.shadowRoot.querySelector('.signOut');
    assert.notOk(button);
  });

  test('Sign out button is rendered when auth set', function(done) {
    element.signedIn = true;
    flush(() => {
      const button = element.shadowRoot.querySelector('.signOut');
      assert.ok(button);
      const display = getComputedStyle(button).display;
      assert.notEqual(display, 'none');
      done();
    });
  });

  test('Sign in button hidden', function(done) {
    element.signedIn = true;
    flush(() => {
      const button = element.shadowRoot.querySelector('.signIn');
      assert.ok(button);
      const display = getComputedStyle(button).display;
      assert.equal(display, 'none');
      done();
    });
  });
});

suite('signIn', function() {
  let element;
  setup(function(done) {
    element = fixture('SetupReady');
    flush(() => done());
  });

  test('Calls signIn() on the aware', function() {
    let called;
    element.$.authAware.signIn = () => called = true;
    element.signIn();
    assert.isTrue(called);
  });

  test('Calls signIn for spacebar press', () => {
    let called;
    element.signIn = () => called = true;
    const e = new CustomEvent('keydown', {});
    e.keyCode = 13;
    element._signInKeyPress(e);
    assert.isTrue(called);
  });

  test('Calls signIn for enter press', () => {
    let called;
    element.signIn = () => called = true;
    const e = new CustomEvent('keydown', {});
    e.keyCode = 32;
    element._signInKeyPress(e);
    assert.isTrue(called);
  });

  test('Ignores other keys', () => {
    let called = false;
    element.signOut = () => called = true;
    const e = new CustomEvent('keydown', {});
    e.keyCode = 48;
    element._signInKeyPress(e);
    assert.isFalse(called);
  });
});

suite('signOut', function() {
  let element;
  setup(function() {
    element = fixture('SetupReady');
  });

  test('Calls signOut() on the aware', function() {
    let called;
    element.$.authAware.signOut = () => called = true;
    element.signOut();
    assert.isTrue(called);
  });

  test('Calls signOut for spacebar press', () => {
    let called;
    element.signOut = () => called = true;
    const e = new CustomEvent('keydown', {});
    e.keyCode = 13;
    element._signOutKeyPress(e);
    assert.isTrue(called);
  });

  test('Calls signOut for enter press', () => {
    let called;
    element.signOut = () => called = true;
    const e = new CustomEvent('keydown', {});
    e.keyCode = 32;
    element._signOutKeyPress(e);
    assert.isTrue(called);
  });

  test('Ignores other keys', () => {
    let called = false;
    element.signOut = () => called = true;
    const e = new CustomEvent('keydown', {});
    e.keyCode = 48;
    element._signOutKeyPress(e);
    assert.isFalse(called);
  });
});
</script>
</body>

</html>
